<!DOCTYPE html>
<html lang="vi">
<head>
	<title>Divisima | Sign up?</title>
	<meta charset="UTF-8">
	<meta name="description" content=" Divisima | eCommerce Template">
	<meta name="keywords" content="fashio, eCommerce, creative, html, signup">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Favicon -->
	<link href="/resources/img/favicon.ico" rel="shortcut icon"/>

	<!-- Google Font -->
	<link href="https://fonts.googleapis.com/css?family=Josefin+Sans:300,300i,400,400i,700,700i" rel="stylesheet">

	<!-- Stylesheets -->
	{{!-- <link rel="stylesheet" href="/resources/css/login.css"/> --}}

	<!-- JavaScript -->
    <script src="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/alertify.min.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/alertify.min.css"/>
    <!-- Default theme -->
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/default.min.css"/>
    <!-- Semantic UI theme -->
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/semantic.min.css"/>
    <!-- Bootstrap theme -->
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/bootstrap.min.css"/>
    <style>
@import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@500&display=swap');
*{
    padding: 0;
    margin: 0; 
    font-family: 'Quicksand', sans-serif;
   }
body{
    background: #fff;
}
.container{
    position: relative;
    width: 100%;  height: 100vh;
    background: linear-gradient(180deg , #fff 0% 50%, #ff1167 50% 100%);
}
.container .login{
    position: absolute;
    top: 50%;   left: 50%;
    transform: translate(-50%,-50%);
    width: 500px;
    padding: 40px 20px 0;
    box-shadow: 0 0 20px rgba(0,0,0,.5);
    box-sizing: border-box;
    background: #fff;
}
.container .login .form{
    position: relative;
}
.container .login .form .row{
    position: relative;
    margin: 23px 0;
    width: 100%;
}
.container .login .form .row input{
    position: relative;
    border: none;   outline: none;
    width: 100%;
    padding: 6px 0;
    border-bottom: 1px solid #726b6b;
    font-size: 20px;
    color: #726b6b;
    background: transparent;
}
.container .login .form .row span{
    color: #726b6b;  background: transparent;
    display: inline-block;
    padding: 3px 10px;
    position: absolute;
    top: 8px;  left: 0;
    font-size: 15px;
    text-transform: uppercase;
    transition: .5s;
    z-index: -1;
}
.container .login .form .row input:focus + span ,
.container .login .form .row input:valid + span ,
.later-for-email{
    color: #fff !important;  background: #e91e63 !important;
    top: -20px !important;
}
.container .login .form .row-3{
    display:flex;
    justify-content: space-between;
    margin: 20px 0;
    margin-bottom:10px;
}
.container .login .form .row input[type = 'submit']{
    width: auto;
    border: none;
    color: #fff;  background: #e91e62bd;
    padding: 10px 20px;
    border-radius: 50px;
    cursor: pointer;
}
input[type="submit"]:hover{
    background: #e91e62bd !important;
}
.logo-container{
    text-align: center;
}
.signup{
    margin:auto 0;
}
.quenmk{
    font-size: smaller;
    text-decoration: none;
}
.quenmk:hover{
    color:black;
}

@media only screen and (max-width:500px){
    .login{
        width:100% !important;
    }
}

@keyframes slide-out-elliptic-top-bck {
  0% {
    transform: translateY(0) rotateX(0) scale(1);
    transform-origin: 50% 1400px;
    opacity: 1;
  }
  100% {
    transform: translateY(-600px) rotateX(-30deg) scale(0);
    transform-origin: 50% 100%;
    opacity: 1;
  }
}
.slide-out-elliptic-top-bck {
	animation: slide-out-elliptic-top-bck 0.7s ease-in both;
}
    </style>
</head>
<body>
    <div class="container">
        <div class="login">
            <div class="logo-container">
                <a href="/" class="logo">
				<img src="/resources/img/logo.png" alt="">
			</a>
            </div>
            <div class="form">
                <div class="row">
                    <input type="text" required name="fullname" id="fullname">
                    <span>Họ tên</span>
                </div>
                <div class="row">
                    <input type="email" required name="email" id="email" placeholder="">
                    <span>E-mail</span>
                </div>
                <div class="row">
                    <input type="text" required name="username" id="username">
                    <span>Tài khoản</span>
                </div>
                <div class="row">
                    <input type="password" required name="password" id="password">
                    <span>Mật khẩu</span>
                </div>
                <div class="row">
                    <input type="password" required name="password1" id="password1">
                    <span>Nhập lại mật khẩu</span>
                </div>
                <div class="row row-3">
                    <a href="/login" class="signup">Đã có tài khoản</a>
                    <input type="submit" value="Đăng nhập" id="submit">
                </div>
            </div>
        </div>
    </div>  

    <!--====== Javascripts & Jquery ======-->
	<script src="/resources/js/jquery-3.2.1.min.js"></script>
    {{!-- <script src="/resources/js/signup.js"></script> --}}
    <script>
        // Extend existing 'alert' dialog
        if(!alertify.errorAlert){
        //define a new errorAlert base on alert
            alertify.dialog('errorAlert',function factory(){
                return{
                        build:function(){
                            var errorHeader = '<span class="fa fa-times-circle fa-2x" '
                            +    'style="vertical-align:middle;color:#e10000;">'
                            + '</span> Lỗi';
                            this.setHeader(errorHeader);
                        }
                    };
                },true,'alert'
            );
        }

        var submit = $('#submit');
        $('#fullname').focus();
        $('body').keypress(function(e){
            if(e.keyCode==13)
            submit.click();
        });

        function checkHovaTen(){
            var tk = $('#fullname').val();
            if(tk.length === 0 ){
                alertify.errorAlert("<h3>Không được bỏ trống họ và tên!</h3>");
                return false;
            }
            //character data validation  
            if(!isNaN(tk)){  
                alertify.errorAlert("<h3>Tên chỉ có thể là chữ cái!</h3>");
                return false;  
            }  
            return true;
        }

        function checkEmail(){
            var email = $('#email'); 
            if(email.val().length === 0 ){
                alertify.errorAlert("<h3>Không được bỏ trống E-mail!</h3>");
                return false;
            }else{
                var filter = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
                if (!filter.test(email.val())) { 
                    alertify.errorAlert("<h3>Hãy nhập địa chỉ email hợp lệ.<br/>Ví dụ như: \nExample@gmail.com</h3>");
                    email.focus();
                    return false; 
                }
            }
            return true;
        }

        function checktk(){
            var tk = $('#username').val().length;
            if(tk === 0 ){
                alertify.errorAlert("<h3>Không được bỏ trống tên đăng nhập</h3>");
                return false;
            }
            return true;
        }

        function checkpass(){
            var pass = $('#password').val();
            var pass1 = $('#password1').val();
            if(pass.length === 0 ){
                alertify.errorAlert("<h3>Xin điền mật khẩu</h3>");
                return false;
            }
            if(pass1.length === 0 ){
                alertify.errorAlert("<h3>Xin xác nhận lại mật khẩu</h3>");
                return false;
            }
            //minimum password length validation  
            if(pass.length < 8) {
                alertify.errorAlert("<h3>Mật khẩu phải dài ít nhất 8 ký tự !!</h3>");
                return false;  
            }
            if(pass !== pass1) {
                alertify.errorAlert("<h3>Mật khẩu không giống nhau</h3>");
                $('#password1').val("");
                $('#password1').focus();
                return false;  
            }
            return true;
        }

        submit.on('click',function(event){
            event.preventDefault();
            if(!checkHovaTen()) return;
            if(!checkEmail())   return;
            if(!checktk())      return;
            if(!checkpass())    return;
            var username = $('#username').val();
            var pass = $('#password').val();
            $.post("/account/check-account",{username: username, password: pass},function(data, status){
                var return_mode = data.return_mode;
                if(return_mode === 0){     //tai khoan chua co nguoi su dung, co the dang ky
                    const bodyData = {
                        fullname: $('#fullname').val(),
                        email: $('#email').val(),
                        username: $('#username').val(),
                        password: $('#password').val()
                    }
                    $.post("/account/create-account",{fullname: bodyData.fullname,email:bodyData.email,username:bodyData.username,password:bodyData.password},
                    function(data, status){
                        if(status === 406){
                            alertify.errorAlert("<h3>Yêu cầu không được chấp thuận. Xin hãy thử lại sau</h3>");
                        }
                        console.log('back from create-account');
                    });
                    setTimeout(function(){
                        submit.text('Thành công!');
                        $('body').addClass("slide-out-elliptic-top-bck");
                    },50);
                    setTimeout(function(){
                        window.location.replace('account/verification');
                    },550);
                }else{
                    $('#username').val("");
                    $('#username').focus();
                    alertify.errorAlert("<h3>Tên đăng nhập đã có người sử dụng</h3><br/>Xin hãy chọn một tên đăng nhập mới");
                } 
            });   
        });

        $('#email').on('focusout',function(){
            console.log('off-focus - '+$(this).val().length);
            if($(this).val().length>0){
                $(this).next('span').addClass('later-for-email');
            }else{
                $(this).next('span').removeClass('later-for-email');
            }
        })
    </script>
</body>
</html>