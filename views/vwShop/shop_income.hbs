<div class="container_income">
    <div class="container_income_navbar">
        <div class="btn_show">
            <span class="fas fa-bars"></span>
        </div>
        <script>
            $('.btn_show').click(function(){
                $('.container_income').toggleClass("show");
                $('.sidebar').toggleClass("show");
            });
        </script>
        <div class="title_bar">
            Doanh thu
        </div>
        <div class="account_bar">
            <div class="account_bar_inner">
                <div class="img_shop_account">
                    <img src="/resources/img/shop/logo.9376039b.png" alt="" class="img_account_inner">
                </div>
                <div class="name_account">
                    Divisia Shop
                </div>
                <div class="down_arrow">
                    <i class="fas fa-angle-down"></i>
                </div>
            </div>
            <div class="func_account_bar" id="func_auth_bar">
                <div class="func_acc" id="pass_shop">
                    Thay đổi mật khẩu
                </div>
                <div class="func_acc" id="info_shop">Thông tin Shop</div>
                <div><hr class="inline"></div>
                <div class="func_acc" id="log_out_shop">
                    <form method="POST" id="frmLogout" action="/logout"></form>
                        <script>
                            function logout(){
                                $.post('/logout',function(data,status){
                                    window.location.replace(data.location);
                                })
                            }
                        </script>
                    <a href="javascript: logout();" class="option-select-auth noHover" >Đăng xuất</a>
                </div>
            </div>
            <script>
                document.addEventListener("click", (evt) => {
                    const deactive_authe_menu = document.getElementById("func_auth_bar");
                    if (event.target.closest(".account_bar_inner")) {
                        deactive_authe_menu.style.display="block";
                        return;
                        }
                    deactive_authe_menu.style.display="none";
                    });
            </script>
        </div>
    </div>

    <div class="container_in">
        <div class="container_income_items">
            <div class="container_item_include">
                <div class="container_item_ic " style="background-color:rgb(57, 159, 255)">
                    <div class="product_selling">
                        Sản phẩm đang bán
                    </div>
                    <div class="product_selling_number">
                        {{#with countProductSelling}}
                            {{SL}}
                        {{/with}}
                    </div>
                    <div class="container_btn">
                        <div class="product_selling_btn">
                            <div class="func_btn">
                                <div style="margin-right: 6px;">
                                    <i class="fas fa-tshirt"></i>
                                </div>
                                <div>
                                    Danh sách sản phẩm
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="container_item_ic" style="background-color:rgb(63, 104, 218)">

                    <div class="product_selling">
                        Đơn hàng chờ xác nhận
                    </div>
                    <div class="product_selling_number">
                        {{#with countWatingBill}}
                        {{SoLuong}}
                        {{/with}}
                    </div>
                    <div class="product_selling_func">
                        <div class="name_func">
                            Đang xác nhận
                        </div>
                        <div class="number_func">
                            {{#with countConfirmingBill}}
                            {{SoLuong}}
                            {{/with}}
                        </div>
                    </div>
                    <div class="product_selling_func">
                        <div class="name_func">
                            Đang giao
                        </div>
                        <div class="number_func">
                            {{#with countTravellingBill}}
                            {{SoLuong}}
                            {{/with}}
                        </div>
                    </div>
                    <div class="product_selling_func">
                        <div class="name_func">
                            Đã giao
                        </div>
                        <div class="number_func">
                            {{#with countTravelledBill}}
                            {{SoLuong}}
                            {{/with}}
                        </div>
                    </div>
                    <div class="product_selling_func">
                        <div class="name_func">
                            Đã hủy
                        </div>
                        <div class="number_func">
                            {{#with countRemoveBill}}
                            {{SoLuong}}
                            {{/with}}
                        </div>
                    </div>
                    <div class="container_btn">
                        <div class="product_selling_btn">
                            <div class="func_btn">
                                <div style="margin-left: 4px; margin-right: 10px">
                                    <i class="fas fa-file-invoice-dollar"></i>
                                </div>
                                <div>Xác nhận đơn hàng</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="container_item_ic" style="background-color:rgb(42, 42, 158)">
                    <div class="product_selling">
                        Doanh thu hôm nay
                    </div>
                    <div class="product_selling_number">
                        {{#with moneyToday}}
                        {{tongtien}}
                        {{/with}}
                    </div>
                    <div class="product_selling_func">
                        <div class="name_func">
                            Tổng đơn hàng hôm nay
                        </div>
                        <div class="number_func">
                            {{#with countBillToday}}
                            {{tongDon}}
                            {{/with}}
                        </div>
                    </div>
                    <div class="product_selling_func">
                        <div class="name_func">
                            Sản lượng bán hôm nay
                        </div>
                        <div class="number_func">
                            {{#with countAmountProductSellingToday}}
                            {{tongSanPhamHomNay}}
                            {{/with}}
                        </div>
                    </div>
                    <div class="product_selling_func">
                        <div class="name_func">
                            30 ngày gần đây
                        </div>
                        <div class="number_func">
                            {{#with getMoneyMonth}}
                            {{tongTienThang}}
                            {{/with}}
                        </div>
                    </div>
                </div>
            </div>
            <div class="container_item_rate">
                <div class="product_selling_rate">
                    Chỉ số năng lực
                </div>
                {{#with getStarShop}}
                    {{#if isHaveStar}}
                        <div class="product_rate_star">
                            {{this.soSaoTB}}/5.0
                        </div>
                    {{else}}
                        <div class="product_rate_star">
                            Chưa có đánh giá
                        </div>
                    {{/if}}
                {{/with}}
                <div class="wrap-stars">
                    <div class="stars-outer">
                        <div class="stars-inner"></div>
                    </div>
                </div>
                {{#with getStarShop}}
                    {{#if isHaveStar}}
                    <script>
                        const starsTotal=5;
                        function getRatings(numberRating){
                            var num=0
                            if (num===null)
                            {
                                num=0;
                            }
                            else
                            {
                                num=parseFloat(numberRating)
                            }
                            const starPercentage=num/starsTotal *100;
                            document.querySelector(`.stars-inner`).style.width=`${starPercentage}%`;
                        }
                        document.addEventListener('DOMContentLoaded',getRatings({{this.soSaoTB}}));
                    </script>
                    {{/if}}
                {{/with}}

                <div class="rating_title" style="margin-top: 30px;">
                    Các chỉ số được reset mỗi tháng
                </div>

                <div class="product_rating_func">
                    <div class="name_func">
                        Tỉ lệ đơn hàng hủy
                    </div>
                    <div class="number_func">
                        {{percentDiscard}}% <i class="fas fa-info-circle"></i>
                    </div>
                </div>

                <div class="product_rating_func">
                    <div class="name_func">
                        Tỉ lệ xử lý chậm
                    </div>
                    <div class="number_func">
                        0% <i class="fas fa-info-circle"></i>
                    </div>
                </div>

                <div class="product_rating_func">
                    <div class="name_func">
                        Tỉ lệ sản phẩm lỗi
                    </div>
                    <div class="number_func">
                        0% <i class="fas fa-info-circle"></i>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>
<div class="container_income">
  <div class="container_in" style="display: flex;" >
      <div class="container_income_items" style="padding-top: 100px;padding-bottom: 100px;padding-left: 20px; padding-right: 150px;">
            <div class="col-lg-6">
                    <div class="">
                            <div id="chartContainer" style="height: 300px; width: 100%; "></div>
                            <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="">
                            <div id="chartContainer2" style="height: 300px; width: 120%; "></div>
                            <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
                        </div>
                    </div>
    </div>
    
  </div>
</div>


{{#each last7daysIncome}}
      <input type="hidden" id="day{{id}}" data-x="{{x}}" data-y="{{y}}"> 
{{/each}} 
{{#each last7monthIncome}}
      <input type="hidden" id="month{{id}}" data-x="{{x}}" data-y="{{y}}"> 
{{/each}} 
<script>
  window.onload = function () {
    CanvasJS.addCultureInfo("es", 
    {                      
      months: ['T1', 'T2', 'T3', 'T4', 'T5','T6', 'T7','T8', 'T9', 'T10', 'T11', 'T12']
      
    });
    var dataPointDay = [];
    for(var i = 0; i < 7; i++){
      const x = $('#day'+i.toString()).data('x')
    
      const y = $('#day'+i.toString()).data('y')
      dataPointDay.push({x: new Date(x), y: y})
    }
    var dataPointMonth = [];
    for(var i = 0; i < 7; i++){
      const x = $('#month'+i.toString()).data('x')
      const y = $('#month'+i.toString()).data('y')
      dataPointMonth.push({x: new Date(x), y: y})
    }
    
    var chart = new CanvasJS.Chart("chartContainer", {
        culture: "es",
        animationEnabled: true,
        theme: "light2",
        title: {
            text: "Doanh thu hàng ngày"
        },
        axisX: {
            valueFormatString: "DD MMM",
            crosshair: {
                enabled: true,
                snapToDataPoint: true
            }
        },
        axisY: {
            title: "Số tiền (VND)",
            includeZero: true,
            crosshair: {
                enabled: true
            }
        },
        toolTip: {
            shared: true
        },
        legend: {
            cursor: "pointer",
            verticalAlign: "bottom",
            horizontalAlign: "left",
            dockInsidePlotArea: true,
            itemclick: toogleDataSeries
        },
        data: [{
            type: "line",
            showInLegend: true,
            name: "Tổng tiền",
            markerType: "square",
            xValueFormatString: "DD MMM, YYYY",
            color: "#F08080",
            dataPoints: dataPointDay,
        },
        ]
    });
    chart.render();
    var chart2 = new CanvasJS.Chart("chartContainer2", {
        animationEnabled: true,
        theme: "light2",
        title: {
            text: "Doanh thu hàng tháng"
        },
        axisX: {
            valueFormatString: "MM, YYYY",
            crosshair: {
                enabled: true,
                snapToDataPoint: true
            }
        },
        axisY: {
            title: "Số tiền (VND)",
            includeZero: true,
            crosshair: {
                enabled: true
            }
        },
        toolTip: {
            shared: true
        },
        legend: {
            cursor: "pointer",
            verticalAlign: "bottom",
            horizontalAlign: "left",
            dockInsidePlotArea: true,
            itemclick: toogleDataSeries
        },
        data: [{
            type: "line",
            showInLegend: true,
            name: "Tổng tiền",
            markerType: "square",
            xValueFormatString: "MMM, YYYY",
            color: "#F08080",
            dataPoints: dataPointMonth,
        },
        ]
    });
    chart2.render();
    function toogleDataSeries(e) {
        if (typeof (e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
            e.dataSeries.visible = false;
        } else {
            e.dataSeries.visible = true;
        }
        chart.render();
        chart2.render();
    }

    


}
</script>
